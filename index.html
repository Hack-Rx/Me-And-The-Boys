<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Sync Vids</title>
	<link rel="stylesheet" href="https://cdn.plyr.io/3.6.2/plyr.css" />
</head>
<body>
	<div class="plyr__video-embed" id="player">
	  <iframe
	    src="https://www.youtube.com/embed/bTqVqk7FSmY?origin=https://plyr.io&amp;iv_load_policy=3&amp;modestbranding=1&amp;playsinline=1&amp;showinfo=0&amp;rel=0&amp;enablejsapi=1"
	    allowfullscreen
	    allowtransparency
	    allow="autoplay">
	  </iframe>
	</div>
	<button onclick="add(.1)">add</button>
	




	<script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-database.js"></script>
	<script src="fireconfig.js"></script>
	<script src="https://cdn.plyr.io/3.6.2/plyr.js"></script>
	<script type="text/javascript">
		const id =  Math.floor((Math.random() * 9999999) + 1); 
		const player = new Plyr('#player');
		var database = firebase.database();
		var isMaster = false;
		var fdb = firebase.database();
		fdb.ref('/master').once('value').then(function(snapshot) {
  		var master = snapshot.val();
  		if (master == 'unset') {
  			isMaster = true;
				fdb.ref('/master').set(id);
  		}
  	});

  	var video = firebase.database().ref('video');
		video.on('value', function(snapshot) {
			let {curr,id,playing} = snapshot.val();
			if (playing == true && player.playing) {
				console.log('here');
				if (player.currentTime>curr+4 || player.currentTime<curr-4) {
					player.currentTime = curr;
				}
			}	
		});
		setInterval(function(){ 
			if (isMaster && player.playing) {
				fdb.ref('/video/playing').set(true);
				fdb.ref('/video/curr').set(player.currentTime);
			}

		}, 4000);
// 0 2 @ * () % ^ & $ # ! 		
//file:///C:/Users/Rishabh/Documents/firesync/index.html
	</script>

</body>
</html>